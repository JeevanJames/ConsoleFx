version: 2.0.0-build.{build}
image: Visual Studio 2019
environment:
  MYGET_API_KEY:
    secure: 3tEiaoqZlTJcJkAX+3wWyp3mbCYuJpALEFzTEaum6ACiXbWgsa1kWYGBi3TUFY7c
  MYGET_FEED: https://www.myget.org/F/consolefx/api/v2/package
  CODECOV_TOKEN: 9393205e-cfa3-459f-a3d4-af5c04c3410d
  MYGET_SYMBOLS_FEED: https://www.myget.org/F/consolefx/symbols/api/v2/package
  MYGET_SYMBOLS_API_KEY:
    secure: 3tEiaoqZlTJcJkAX+3wWyp3mbCYuJpALEFzTEaum6ACiXbWgsa1kWYGBi3TUFY7c
install:
- pwsh: choco install codecov
# Download .NET Core 2.2.401 SDK and add to PATH
- ps: $urlCurrent = "https://download.visualstudio.microsoft.com/download/pr/4de548ef-9b51-4b1f-ae3a-60ebd6a6f2b5/01fce24fe286e7475fdbecc60f1daee5/dotnet-sdk-2.2.401-win-x64.zip"
- ps: $env:DOTNET_INSTALL_DIR = "$pwd\.dotnetsdk"
- ps: mkdir $env:DOTNET_INSTALL_DIR -Force | Out-Null
- ps: $tempFileCurrent = [System.IO.Path]::GetTempFileName()
- ps: (New-Object System.Net.WebClient).DownloadFile($urlCurrent, $tempFileCurrent)
- ps: Add-Type -AssemblyName System.IO.Compression.FileSystem; [System.IO.Compression.ZipFile]::ExtractToDirectory($tempFileCurrent, $env:DOTNET_INSTALL_DIR)
- ps: $env:Path = "$env:DOTNET_INSTALL_DIR;$env:Path"  
build_script:
- pwsh: dotnet build -c Release
test_script:
- pwsh: >-
    dotnet test --blame ./test/CmdLine.Parser.Tests/CmdLine.Parser.Tests.csproj /p:CollectCoverage=true /p:Exclude=\"[xunit.*]*\" /p:CoverletOutputFormat=opencover

    codecov -f "./test/CmdLine.Parser.Tests/coverage.opencover.xml"

    dotnet test --blame ./test/ConsoleExtensions.Tests/ConsoleExtensions.Tests.csproj /p:CollectCoverage=true /p:Exclude=\"[xunit.*]*\" /p:CoverletOutputFormat=opencover

    codecov -f "./test/ConsoleExtensions.Tests/coverage.opencover.xml"
deploy_script:
- pwsh: ./.build/deploy.ps1
